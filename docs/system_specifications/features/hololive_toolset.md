# ホロライブOCGツール仕様

## 1. カード検索エンジン

### 除外ロジック
- **エールカード**: 
    - **データ管理**: 公式サイトとの件数照合（スクレイピング時のスキップ判定）のため、`hololive-cards.json` 内には全件保持されます。
    - **UI表示**: アプリケーション（`useCardSearch.ts`）で `cardType` が「エール」のカードは検索結果から常に除外されます。

### キーワード検索
- **正規化 (Normalization)**: 入力テキストは Unicode正規化 (NFKC) を行い、小文字化します。
- **ひらがな対応**: 検索キーワードとカード名の両方を内部的にカタカナに変換して比較することで、「サクラ」と「さくら」の表記ゆれを吸収してヒットさせます。
- **記号無視照合**: カード名やキーワードに含まれる記号（`・`, `ー`, 空白, `-`, `!`, `?` 等）を除外した状態でも判定を行います。
    - これにより、「じむ」で「ジジ・ムリン」、「ずぶ」で「ローズ・ブラッド...」などの、記号や長音（ー）を挟む検索もヒットするようになります。

### フィルタリング仕様
- **カラーフィルタ (色)**:
    - **単色**: 色文字列が1文字 (`length === 1`)
    - **多色**: 色文字列が2文字以上 (`length >= 2`)
    - **無**: 「◇」記号のみ一致
    - **特定色**: 各色ボタンが押されている場合、`includes` で部分一致判定。
- **タイプフィルタ**:
    - **サポート**: 「サポート」で始まるタイプ（アイテム・イベント等を含む）
    - **LIMITED**: タイプ名に「LIMITED」が含まれるもの
    - **ホロメン / 推しホロメン**: 完全一致
- **Bloomレベルフィルタ**:
    - `Debut`, `1st`, `2nd`, `Spot` の完全一致

## 2. ピン留め機能 (Bookmarks)
- **枚数制限**: 最大 **100枚**。
- **上限到達時**: アラートを表示して追加をブロックします。
- **永続化**: `localStorage` に保存。

## 3. UIと操作
- **無限スクロール**: 50枚ずつの遅延読み込み(`IntersectionObserver`)を採用。
- **キーボードナビゲーション**:
    - `Tab`: 検索タブとピン解除タブの切り替え。
    - `矢印キー (← → ↑ ↓)`: グリッド内のカード選択と自動スクロール。
- **オーバーレイ連携**: 選択されたカードは即座にオーバーレイ窓へ送信され、拡大表示されます。
    - **表示モード (Display Mode)**: コントローラーから「画像モード」と「テキストモード」を切り替え可能です。
        - **テキストモード**: カード名、HP/LIFE、属性（色）、スキル、アーツ、バトンタッチ、キーワード能力、注釈テキストを構造化して表示します。
            - サポートカード（アイテム、イベント等）は、「サポート・」を取り除いた**カテゴリ名のみ**を種別欄に表示します。
            - **LIMITEDカード**の表記は種別欄から削除し、カード最下部の注記セクションに「**LIMITED: ターンに1枚しかつかえない**」と表示されます。
            - **カード名**: 視認性とデザイン性を高めるため、**常に白文字**で固定されます。
            - **ヘッダーレイアウト**: 最上部の行は、属性情報（色・レベル）を左側に、ステータス（HP）を右側に寄せる機能的な配置を採用しています。
                - **左側**: [**タイプアイコン**] [**カードタイプ/レベル** (Debut/1st等)]
                - **右側**: [**HP / ❤ 数値**]
            - **タイプアイコン**:
                - ホロメンおよび推しホロメンカードにおいて、カードの色に応じた公式スタイルのアイコン（`type_***.png`）を表示します。
                - 単色だけでなく、多色カード（「青赤」など）の場合も対応する連結アイコンを動的に表示します。
            - **バトンタッチ**: ホロメンおよびBuzzホロメンカードでは常に項目を表示します。
                - コストがある場合は、対応する色のカラーアイコン（エネルギーアイコン）を表示します。
                - 公式サイトでコストアイコンがない（コスト0）場合、アイコンを表示せず「バトンタッチ」テキストのみを表示し、情報の網羅性を担保します。
            - **アーツ**: コスト表示には、対応する色のエネルギーアイコン（`arts_***.png`）が並べて表示されます。
            - 推しスキルのコストは「**ホロパワー**」として表記されます。
            - **属性（色）の判定**: 内部的には `includes` を使用し、多色カードやデータのゆれを許容してアイコンイメージを動的に解決します。
            - 緑色属性はエメラルドグリーンを採用し、OBSのクロマキー環境での視認性を確保しています。
        - **窓間同期**: 表示モードの状態（画像/テキスト）は、`BroadcastChannel` を通じてコントローラーとオーバーレイ窓で完全に同期されます。位置や回転の調整はオーバーレイ窓上の共通ハンドル（OverlayWidget）を使用して行います。
    - **機材表示レイアウト**: オーバーレイ時、カード画像/テキストの上にサイコロが表示されます。
    - **ダイス配置の最適化**: 3Dサイコロがカードの情報を極力遮らないよう、カードの縁（上端または下端）に完全に密着した配置が行われます。
        - 内部的にネガティブマージンを適用し、コンテナのパディングを無視して枠の境界まで寄せることで、カード画像やテキストとの重複を最小限に抑えています。
        - 視認性向上のため、サイコロの背景には薄い半透明パネルが配置されます。
    - **OBS最適化描画**: 
        - **角丸とエッジ**: オーバーレイのカード枠は `24px` (rounded-3xl) の角丸を持ちます。
        - **インライン・マージン**: テキスト表示モード時、環境に依存せず確実に余白を確保するため、**インラインスタイル (`style={{ padding: '24px' }}`)** が適用されます。これにより、枠線とテキストの間に視覚的に安定した空間を提供します。
        - **背景の不透明化**: OBSでのクロマキー（グリーンバック）使用時でもカード内容が透けないよう、枠内は常に不透明な暗色 (`#111827`) で描画されます。
    - **機材表示制限**: ホロライブモードではダイスのみを使用するため、オーバーレイ窓（カード表示オフ時含む）およびコントローラー側ではコインの表示が抑制されます。
