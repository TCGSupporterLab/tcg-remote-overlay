# ビデオソース・オーバーレイ機能の実装計画

OBSを使用せずに、ブラウザ上でカメラ映像やウィンドウ映像（盤面）を取り込み、その上にカード情報を重ねて表示する機能を実装します。**既存の背景モード（通常、透過、グリーンバック）はそのまま残し、必要に応じて映像を重ねられるようにします。**

## 変更内容

### 1. 新規コンポーネント: `VideoBackground`
- **機能**:
  - `navigator.mediaDevices.getUserMedia` (カメラ) または `getDisplayMedia` (画面キャプチャ) を使用して映像を取得。
  - `video` 要素で映像を再生し、アプリ全体 (`main` 要素内、または `App` 直下) の背景として **z-index: -1** などで絶対配置。
  - 映像の反転 (水平ミラー) オプション。
  - `object-fit: cover` を使用して画面全体を覆うように設定。

### 2. `App.tsx` への操作UI追加
- **位置**: ヘッダーの「オーバーレイ起動」ボタンの隣、または設定メニュー内に、ビデオソース選択のトグル/ドロップダウンを追加。
- **ショートカット**: `V` キーなどでビデオソースのオン/オフを切り替えられるように検討。
- **同期**: `BroadcastChannel` (`remote_duel_sync`) に `VIDEO_SOURCE` メッセージを追加し、コントローラーとオーバーレイ窓で映像ソースの状態（どのカメラか、画面キャプチャか等）を同期（※ただしセキュリティ上、各窓で個別にキャプチャ許可が必要）。

### 3. オーバーレイ画面の統合
- オーバーレイ窓（`mode=overlay`）においても、指定されたビデオソースを背景として表示できるようにします。
- **既存機能との共存**: ビデオソースが「無し」の場合は従来の動作。映像が表示されている間も、UIの透過設定などは有効なまま維持します。

## 対象ファイル
- `src/components/VideoBackground.tsx` [NEW]
- `src/App.tsx` (コンポーネントの配置)
- `src/components/HololiveTools.tsx` / `YugiohTools.tsx` (UI追加)

## 検討事項
- **セキュリティ**: ブラウザの制限により、ユーザーのクリック操作後の許可が必要です。初回起動時に「カメラを有効にする」等のインタラクションが必要になります。
- **アスペクト比**: 映像のアスペクト比を維持しつつ、画面いっぱいに表示するか、フィットさせるかの切り替え。

## 検証プラン
- カメラ映像が正しく表示され、オーバーレイがその上に重なるか確認。
- ウィンドウキャプチャ（他のブラウザタブやDiscord等）が取り込めるか確認。
- 各種設定（反転など）が反映されるか確認。
