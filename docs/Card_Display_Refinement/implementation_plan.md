# ピン留め機能の構成および同期の挙動改善

## 1. グループ化の定義
ピン留めにおける「同一カード」の判定ルールを整理し、複数の表示インスタンスが存在する場合でも、1つのピン留め操作ですべてが同期するようにします。

### A. リンク関係（常に適用）
- **同一判定条件**: 自身の `path` または `_linkedFrom` が、対象の `path` または `_linkedFrom` と一致する場合。
- **挙動**: `_link.txt` 経由で複数のフォルダに表示されていても、いずれか1つをピン留めすれば全階層でマークが付きます。ピン留めリストへの登録は1つ（実体）のみとなります。

### B. 同名ファイル（設定依存: `mergeSameFileCards`）
- **同一判定条件**: `mergeSameFileCards` が `true` の場合、 `_fileName`（ファイル名）が一致するすべてのカード。
- **挙動**: 
    - **ON (結合) 時**: 別フォルダの同名ファイルもすべて同期されます。ピン留めリストには代表1枚のみが載ります。
    - **OFF (分割) 時**: パスが異なれば別カードとして扱われます。リストにも個別に登録可能です。

## 2. 状態変換ロジック（設定切り替え時）
「同名ファイルを結合する」設定を変更した際、既存のピン留め状態が不自然にならないよう変換を行います。

### OFF → ON (結合) への切り替え
- **ロジック**: 現在のピン留めリストを `_fileName` で名寄せ（Deduplicate）します。
- **結果**: 重複して登録されていた同名ファイルがリスト上で1つに統合されます。

### ON → OFF (分割) への切り替え
- **ロジック**: ユーザーがその「カード（ファイル）」を必要としていた意図を汲み取り、現在の全体データから一致する同名ファイルをすべて探し、それぞれ個別にピン留めリストに追加（展開）します。
- **結果**: 結合を解いた後も、これまでピンが付いていたすべての階層のカードに引き続きチェックが入った状態が維持されます。

## 3. 実装のステップ
1. **同一性判定ユーティリティの実装**: 設定に応じたマッチングキーを生成する関数を `useCardSearch.ts` に追加。
2. **`togglePin` の改修**: グループ単位での一括追加・削除ロジックへの移行。
3. **`useEffect` による自動変換**: `mergeSameFileCards` プロップを監視し、変化時にリストを再構成。
4. **表示キー (`pinnedUniqueKeys`) の更新**: グループ判定の結果に基づき、全データから有効な表示キーをリアルタイムに計算。

---
> [!IMPORTANT]
> リンク関係（`_linkedFrom`）は設定に関わらず常にグループ化されるため、実体ファイルが同じであれば重複してリストに載ることはありません。
