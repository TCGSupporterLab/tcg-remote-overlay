# 画像管理とメタデータの新仕様 (2026-02-21)

## 1. ディレクトリ構造 (3階層ルール)
| 階層 | 名称 | 説明 | スキャン対象 |
| :--- | :--- | :--- | :--- |
| **第0階層** | ROOT | フォルダ選択で選ぶトップ。 | なし (画像無視) |
| **第1階層** | OCGフォルダ | `hololive`, `yugioh` 等。 | `_meta_filter.json`, `_meta_card.json` |
| **第2階層** | フォルダ | `デッキ`, `パック名` 等。 | **画像ファイル**, `_link.txt`, `_meta_card.json` |

- ※第2階層より深いサブフォルダ（第3階層以降）は無視されます。

## 2. メタデータ定義

### `_meta_filter.json` (第1階層専用)
- 役割: **フィルタ管理のマスターファイル**。
- JSONのトップレベルにカテゴリ名、その値に選択肢の配列を表示順で記述します。
- ここに記述された項目**のみ**がフィルタ画面に表示されます。
- フォーマット:
  ```json
  {
    "タイプ": ["ホロメン", "サポート"],
    "色": ["赤", "青"]
  }
  ```

### `_meta_card.json` (第1, 2階層)
- 役割: 各カードの個別情報記述。
- 第1階層（OCG全体管理用）と第2階層（フォルダ内管理用）の両方に置けます。
- 同じファイル名に対する記述がある場合、**第2階層（より具体的）の設定が優先**されます。

## 3. `_link.txt` 仕様 (第2階層専用)
- 役割: 物理的なファイルをコピーせずに、他フォルダの画像を表示。
- 形式: 1行に1パス記述。
  - `{第1階層}/{第2階層}/{ファイル名}.拡張子`
  - 例: `hololive/Series1/001.png`
- 特徴:
  - **メタデータの継承**: リンクされたカードは、自動的にその**リンク先ファイルが持つメタデータ**（`_meta_card.json` の定義）を使用して表示されます。
- パス解析ルール:
  - `/` と `\` を混在可能。
  - `'`（シングル）や `"`（ダブル）クオートでの囲みを自動除去。
  - 存在しないファイルへのリンクは無視。
