# 2階層目でのフィルタ表示不具合の修正計画

2階層目のフォルダ（例: `hololive/all/`）において、フィルタのタブや項目が表示されない不具合を修正します。

## 修正内容

### 1. `src/hooks/useLocalCards.ts` の修正

- `scanDirectory` 関数を修正し、レベル2のフォルダ（サブフォルダ）内にある `_meta_filter.json` もスキャン対象に含めるようにします。
- `loadMetadata` 関数を修正し、`parts.length === 3` の場合（サブフォルダのメタデータ）も読み込めるようにします。
- メタデータのキーを `parts[0]`（OCG名）だけでなく、ディレクトリパス全体（例: `hololive/all`）で管理するようにします。

### 2. `src/hooks/useCardSearch.ts` の修正

- `metadataOrder` の型定義を、階層構造に対応したもの（`Record<string, Record<string, string[]>>`）に更新することを検討するか、あるいはフック内で現在のパス（`currentPath`）に基づいたフィルタ情報を抽出するようにします。
- `dynamicFilterOptions` およびフィルタ適用ロジックで、現在の表示パスに最適なフィルタ情報を選択するように修正します。

### 3. メタデータファイルの配置（必要に応じて）

- `public/images/cardlist/hololive/all/` に `_meta_filter.json` が配置されていない場合は、親フォルダからコピーまたはリンクする対応を検討します。

## 検証計画

### 自動テスト
- 現状、フロントエンドの単体テスト環境が不明なため、コード修正後の目視確認を主とします。

### 手動確認
1. ブラウザでアプリケーションを開く。
2. ホロライブのフォルダを選択し、さらにその下のフォルダ（`all`など）に移動する。
3. フィルタタブ（色、タイプ、Bloomなど）が表示されていることを確認する。
4. 各フィルタ項目（白、緑、赤など）が表示され、正しくフィルタリングされることを確認する。
