# 実装計画: マイレイアウト機能の強化と用語の統一

マイレイアウトの保存機能に映像調整（ズーム、位置、反転、トリミング、回転等）を含めるように拡張し、アプリケーション全体の用語を「ビデオ」から「映像」に統一します。

## ユーザーレビューが必要な事項
- [ ] 映像調整の保存を有効にした場合、現在のズーム率やクロップ状態がそのまま保存されます。レイアウトを適用すると、その時の映像ソース（カメラ/画面共有）に対してその設定が適用されます。
- [ ] 用語「映像」への統一作業において、内部の変数名（例：`videoCrop`）は影響範囲を最小限にするため変更せず、UI上の文言およびドキュメントのみを対象とします。

## 提案される変更

### 用語の統一
- `src/` 配下の全てのコンポーネントおよび `docs/system_specifications/` 配下の仕様書において、「ビデオ」という文言を「映像」に置換します。
- 例: 「ビデオソース」→「映像ソース」、「ビデオ調整」→「映像調整」

### 共通保存ダイアログの導入
- レイアウト保存時に「名前」「保存対象（ウィジェット/映像調整）」を選択できるダイアログ（プロンプトの拡張版）を実装します。

### レイアウト一覧での可視化
- 保存済みのレイアウト一覧において、各項目の名称の横に、保存内容を示す小さなアイコンを表示します。
    - **Layers（レイヤー）アイコン**: ウィジェット配置が保存されている場合。
    - **Video（映像）アイコン**: 映像調整が保存されている場合。
- 適用時に他のウィジェットを隠す設定になっているレイアウトを視覚的に判別できる仕組み（例：アイコンの色の変化や補助バッジ）も検討します。

### 他を隠す設定の個別化と統合
- 現状のグローバルな「適用時に他を非表示」設定を廃止し、**レイアウトごとに「適用時に他を隠す（スナップショットモード）」フラグを保存するように変更**します。
- **保存スコープの連動**: 「ウィジェットを保存」にチェックを入れた際、保存されるウィジェットの範囲は**「他を隠す」のチェック状態**に連動します。
    - **[x] 他を隠す (ON)**: 「非表示」を含む**すべてのウィジェットの状態**を保存する（完全な再現用）。
    - **[ ] 他を隠す (OFF)**: **現在表示されている（または選択されている）ウィジェットのみ**を保存対象とし、非表示のものはデータに含めない（スタンプ的・追加的な運用）。
- **保存対象の初期値（入り口によるフィルタリング）**: 入り口に応じて、対象となるウィジェット群を絞り込みます。
    - **アクションバー**: **選択中**のウィジェットのみを保存候補とする。
    - **映像調整/設定メニュー**: **すべて（表示・非表示問わず）**を保存候補とする。
- **保存ダイアログの初期設定（プリセット）**: 入り口に応じて、最も一般的なユースケースを提示します。
    - **アクションバー**: ウィジェット: **[x]** / 映像: **[ ]** / 他を隠す: **[ ]**
    - **映像調整メニュー**: ウィジェット: **[ ]** / 映像: **[x]** / 他を隠す: **[ ]**
    - **設定メニュー**: ウィジェット: **[x]** / 映像: **[x]** / 他を隠す: **[x]**

### デフォルトレイアウトの更新
- `src/data/default_layout/` 配下の既存のレイアウトファイル（JSON）を、新しい `MyLayout` 構造に適合するように更新します。
- 既存のテンプレートは全て、`hideOthers: true` を設定し、適用時に「シーン全体の切り替え」として動作するようにします。

### [Component] データ構造とストア (`src/types/`, `src/store/`)
#### [MODIFY] [widgetTypes.ts](file:///f:/dev/github/tcg-remote-overlay/src/types/widgetTypes.ts)
- `MyLayout` インターフェースに `videoCrop?: CropConfig` と `hideOthers: boolean` を追加。

#### [MODIFY] [useWidgetStore.ts](file:///f:/dev/github/tcg-remote-overlay/src/store/useWidgetStore.ts)
- `saveLayout(name: string, options: { includeWidgets: boolean, includeVideo: boolean, hideOthers: boolean })` にシグネチャを変更。
- `applyLayout(id: string)` 内で、`layout.hideOthers` が true の場合に他のウィジェットを自動的に非表示にするロジックを実装。
- グローバルな `hideNonLayoutWidgets` 状態とそれに関連する `localStorage` 操作を削除。

### [Component] UIコンポーネント (`src/App.tsx`, `src/components/`)
#### [MODIFY] [App.tsx](file:///f:/dev/github/tcg-remote-overlay/src/App.tsx)
- アクションバーおよび設定メニューからの `saveLayout` 呼び出しを、新設する共通保存ダイアログ経由に変更。

#### [MODIFY] [VideoBackground.tsx](file:///f:/dev/github/tcg-remote-overlay/src/components/VideoBackground.tsx)
- 映像調整モードのUIに「この設定を名前を付けて保存」等の導線を追加。

## 検証計画

### 手動検証
1. **アクションバーからの保存**:
   - ウィジェットを選択し、アクションバーの保存ボタンを押す。
   - ダイアログで「ウィジェット」がデフォルトON、「映像」がOFFであることを確認。
   - 保存して、別のレイアウトから戻した時にウィジェット配置のみが復元されることを確認。
2. **映像調整メニューからの保存**:
   - 映像調整（ズーム等）を行い、保存ボタンを押す。
   - ダイアログで「映像」がデフォルトON、「ウィジェット」がOFFであることを確認。
   - 保存して、映像設定のみが復元されることを確認。
3. **設定メニューからの保存**:
   - デフォルトで両方がONになっていることを確認。
4. **用語統一の確認**:
   - 全てのメニュー、ラベル、仕様書ファイルで「ビデオ」という文言が消え、「映像」になっていることを目視で確認。
