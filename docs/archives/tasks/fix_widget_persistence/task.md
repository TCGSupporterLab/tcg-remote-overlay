# タスク：ウィジェット設定およびステートの永続化の修正

## 現状の課題
- アプリケーション再起動時に、SPマーカーの一時非表示だけでなく、LPのプレイヤー選択（`onlyShowPlayer1`）やカードの表示情報（`cardMode` 等）がリセットされてしまう場合がある。
- 前回の修正で `showSPMarkerForceHidden` を再起動時に `false` にリセットする処理を追加したが、その際のマージ処理や、他の永続化対象プロパティの扱いが不完全である可能性がある。
- `useWidgetStore` 内に未使用または永続化対象外のプロパティ（`pinnedCardIds`）が存在し、実装の不透明さを招いている。

## 修正内容
1. **`useWidgetStore.ts` の初期化ロジックの改善**
   - `getInitialState` において、`localStorage` からの読み込みとデフォルト値のマージをより確実に、かつ最新の型構造に合わせて実施する。
   - `settings` （`initialLP`, `onlyShowPlayer1`, `cardMode` 等）が正しく復元されることを保証する。
2. **未使用プロパティの整理**
   - `useWidgetStore` から `pinnedCardIds` を削除する（カード検索側の `pinnedCards` と重複しており、現在は使用されていないため）。
3. **SPマーカーの状態管理の再点検**
   - `showSPMarkerForceHidden` を `false` にリセットする処理が、他の `visibility` 設定を上書きしないようにマージ順序を確認する。
4. **永続化処理（subscribe）の確実な実施**
   - 変更があった際に `localStorage` へ保存する処理において、漏れがないか確認する。

## 確認事項
- [ ] アプリ再起動後に LP の「Player 1のみ表示」設定が維持されているか。
- [ ] カードの表示モード（ライブラリ/シンプル）が維持されているか。
- [ ] SPマーカーの一時非表示が再起動時に解除され、かつ元の表示/非表示状態は維持されているか。
