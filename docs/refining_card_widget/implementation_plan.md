# 実装計画: カードウィジェットの洗練と独立化

## 背景
これまでカード表示機能は「ホロライブモード」のウィジェットの一部として実装されていました。これを独立したウィジェットに切り出すことで、遊戯王モードなどの他のモードでもカード画像をオーバーレイ表示できるようにすること、および、テキスト表示機能を廃止してメンテナンス性を向上させることを目的とします。

## 変更方針

### 1. キャッシュ管理（状態の同期と永続化）
カードウィジェットに表示する情報を以下の3つのキャッシュ（`useCardSearch` 内の `SharedState` および IndexedDB）で管理します。
1. **拡大表示キャッシュ**: カード検索画面でカードを選択した際の詳細表示情報を保存。 (既存の `selectedCard`)
2. **ピン留めキャッシュ**: ピン留めされたカードのリストを保存。 (既存の `pinnedCards`)
3. **表示番号 (No)**: 現在表示すべき対象を指定する整数（0以上）。新しく `displayCardNo` を追加。

### 2. 表示対象の決定ロジック
`CardWidget` において、以下のロジックで表示するカード（TargetCard）を決定します。
- **ピン留めが0件の場合**: `displayCardNo` の値に関わらず、**拡大表示キャッシュ (selectedCard)** を表示しようとする。
- **ピン留めが1件以上の場合**:
    - `displayCardNo === 0` のとき: **拡大表示キャッシュ (selectedCard)** を表示しようとする。
    - `displayCardNo === n (n >= 1)` のとき: **ピン留めキャッシュ (pinnedCards)** の `n` 番目の要素を表示しようとする。
    - **仕様変更**: `n` がピン留め数より大きい場合は、対象が存在しないものとしてガイダンスを表示する（末尾のカードを強制表示するのではなく、ユーザーに対象不在を明示する）。

### 3. 未選択・対象不在・接続切れ時のガイダンス表示
上記ロジックで決定された **TargetCard が存在しない、または画像が表示できない場合**（例：初回起動時、指定番号のピン留め不在、フォルダ接続切れによる Blob URL 失効時）、カードウィジェット内に以下の案内を表示します。

- **ガイダンス文言 (案)**:
  「表示するカードが選択されていません。
  設定 (Esc / 右クリック) ＞ ウィジェット ＞ カードを表示 ∨
  から画像フォルダに接続し、カードを選択してください。」

### 4. 操作（ショートカット）の変更
- **表示番号の切り替え**: `Shift + 数字キー (0-9)`
  - 遊戯王モードの LP 入力（数字キー単体）との競合を避けるため、Shift キーを必須とします。
  - `displayCardNo` の更新および同期を行います。

## 完了条件
- Shift + 数字キー 0 で検索詳細のカードが、1〜n でピン留めカードが表示されること。
- ピン留めがない状態で Shift + 数字キーを押しても、検索詳細のカードが表示され続けること。
- 何も選択されていない初期状態で、設定メニューへの誘導テキストが表示されること。
- リロード後も最後に選択されていたカードや `displayCardNo` が維持されること。

## コンポーネント構成

- **CardWidget**: 
  - 選択されたカード（`overlayCard`）を画像として表示する。
  - `OverlayWidget` によって、ドラッグ・リサイズ・回転が可能。
  - ゲームモード等に依存せず、設定がONなら常に表示される。

- **HololiveTools**:
  - メイン画面（検索タブ）では従来通りのフル機能を提供。
  - オーバーレイ画面ではダイス/コインのみに特化。

- **OverlayWidget**:
  - `gameMode` 文字列をキーとして位置情報を個別に保存する。
  - `card_widget` という新しいキーを使用することで、ゲームツールとは独立した座標を持つ。

## 完了条件
- 設定メニューの「カードを表示」をONにすると、カード画像がオーバーレイされること。
- 遊戯王モードやホロライブモードに切り替えても、カード画像が独立して表示され続けること。
- テキスト表示切替のUIが消えていること。
