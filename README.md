# TCG Remote Overlay


OBSなどの配信ソフトでの使用や、Discord等の画面共有を用いたリモート対戦を強力にサポートする、トレーディングカードゲーム（TCG）用オーバーレイツールです。「遊戯王OCG」および「ホロライブOCG」に対応しています。

## 🌟 主な機能

### 🛰️ 高機能オーバーレイ (OverlayWidget)
- **自由自在な配置**: マウス操作でウィジェットを画面内の好きな場所に移動、回転、拡大縮小が可能です。
- **優先表示順位管理 (Z-Index)**: ウィジェット間の重なり順をドラッグ＆ドロップで自由に変更可能。
- **最前面表示機能**: 選択中のウィジェットは自動的に最前面へレイヤー移動し、快適な変形操作をサポート。
- **スナップ回転**: 0°/90°/180°/270° に近づくと自動で吸い付くスマート回転機能を搭載。
- **全画面モード**: ブラウザのアドレスバーやタブを隠して、アプリ単体で配信画面のような没入感を実現。
- **レスポンシブ・スケーリング**: ウィンドウのサイズを変更すると、1920x1080を基準としてウィジェットの大きさが自動的に調整され、レイアウトと視認性を完璧に維持します。
- **スマート・アクションバー**: 複数選択時にグループ化操作が可能なフローティングバーが表示され、画面端やローテートハンドルの邪魔にならないよう動的に配置されます。
- **ウィジェット・グループ機能**: 複数のウィジェットをグループ化して、まとめて移動や回転が可能です。
- **スマート・リセット**: 単体またはグループ化されたウィジェットを、結合時のレイアウトを維持したまま瞬時に画面中央へ戻すことができます。
- **マイレイアウト機能**: 
    - 現在の配置、グループ構成、重なり順、および**映像調整設定**を名前を付けて保存、呼び出しが可能です。
    - **「他を隠す」機能**: 適用時に他のウィジェットを自動的に非表示にするオプションを選択可能。
    - **コンテキスト依存の保存**: 入り口（アクションバー/設定メニュー）に応じて、選択中のみ保存するか全体を保存するかを自動判別。
    - 外部JSONファイルとしてのエクスポート・インポート、およびフォルダからのデフォルトレイアウト自動読み込みに対応。
- **誤操作防止 (Action Shield & Interaction Exclusion)**: 
    - ウィジェット選択中は内部ボタンが反応しないようガード。
    - 設定メニュー、映像調整パネル、アクションバー上での操作が背景のウィジェットに影響を与えないよう入力を遮断。

### 🎴 独立したウィジェット構成
特定の「モード」に縛られず、以下のウィジェットを自由に組み合わせて配信画面を構成できます。

- **カードウィジェット**: 
  - **空のキャンバス設計**: 初期状態ではアセットを持ち込まず、ユーザーのローカルフォルダからカード画像を読み込んで使用します。
  - **2つの表示モード**: 
    - **シンプルモード**: 好きな画像ファイルをブラウザに直接ドラッグ＆ドロップして即座に表示。
    - **ライブラリモード**: ローカルフォルダを指定し、メタデータ（読みがな、カテゴリ等）に基づいた検索・表示。
  - **高度なドラッグ＆ドロップ**: ウィジェットに画像ファイルを落とせば「シンプルモード」、フォルダを落とせば自動で「ライブラリモード」に切り替わります。
  - **ピン留め機能**: 最大1,000枚まで登録可能。ドラッグ＆ドロップによる自由な並び替えに対応。
  - **状態の自動復元**: ブラウザを閉じても、最後に表示していた画像やフォルダ、ピン留め状態が自動的に復元されます。
- **ライフ計算機**: 
  - 直感的な十キー操作による管理、履歴ログ、Undo/Redo対応。
  - Player 2側を自動で180度反転させるオート反転機能。
- **SPマーカー**: 
  - ホロライブOCG向けのSP状態管理ツール。
- **3D物理ダイス・コイン**: 
  - リアルな挙動の3D物理アニメーション。
- **堅牢な映像背景システム**: 
  - カメラや画面共有の接続ミス、デバイス競合（使用中）、物理的な切断を自動検知して具体的な対処法を案内。

### 🎲 共通機能
- **表示プリセット**: 「遊戯王」「ホロライブ」などのプリセットを選択することで、推奨されるウィジェットの組み合わせを瞬時に呼び出せます。
- **高機能設定メニュー**: 
    - 「ウィジェット」「背景・映像」「マイレイアウト」などのタブに整理され、必要な項目に素早くアクセス可能。
    - メニュー枠外のクリックや `Esc` キーによる直感的な終了操作に対応。
- **リアルタイム同期**: `BroadcastChannel API` により、検索、ピン留め、ウィジェットの表示状態などを複数のウィンドウ・タブ間で完全に同期します。
- **セッション管理**: 同一種別の画面が重複して開かれた場合、古いインスタンスを自動終了させる安全装置を搭載。

## 🚀 使い方

### セットアップ

1.  **リポジトリをクローン**
    ```bash
    git clone https://github.com/TCGSupporterLab/tcg-remote-overlay.git
    cd tcg-remote-overlay
    ```

2.  **依存関係のインストール**
    ```bash
    npm install
    ```

3.  **起動**
    ```bash
    npm run dev
    ```

### 配信ソフト（OBS等）での使用

1.  **オーバーレイを起動**: アプリ右上の「起動」（タブ単位）または「別窓で起動」（ウィンドウ単位）ボタンをクリックしてオーバーレイを表示します。
2.  **OBSに追加**: 「ソース」→「ブラウザ」を追加し、URLに `http://localhost:5173/?mode=overlay` を入力。
3.  **カードの表示**: 検索画面を開き、ローカルのカード画像が入ったフォルダを選択してカードを検索・表示してください。

## ⌨️ キーボードショートカット

| キー | 動作 |
| --- | --- |
| `0-9` | ライフ計算機: 数字入力 / カードウィジェット: ピン留めカード選択 (連続入力で多桁対応) |
| `Shift + 0-9` | カードウィジェット: 表示番号切替 (0: 選択中 / 1-999: ピン留め) |
| `+` / `-` | ライフ計算機: 加算 / 減算 |
| `Enter` | ライフ計算機: 減算実行 |
| `/` | ライフ計算機: ライフを半分にする |
| `.` (テンキー) | ダイスを振る (遊戯王プリセット時: 素早く2回でコイン / ホロライブプリセット時: 素早く2回でSP flip) |
| `O` | SPMarker: 表示/非表示をトグル |
| `D` | ダイスを振る |
| `C` | コインを投げる |
| `V` | 映像ソース切替 (Camera / Screen / OFF) |
| `Shift + V` | 映像ソース切替 (逆送り) |
| `M` | 映像反転モード切替 |
| `A` | 映像調整モードの開始/終了 (オーバーレイ窓上でのホイールクリックでも可) |
| `R (長押し)` | 全状態の一括リセット |
| `Alt + 1` | レイアウト適用 (遊戯王向けおすすめ設定) |
| `Alt + 2` | レイアウト適用 (ホロライブ向けおすすめ設定) |
| `右クリック` | 設定メニューを表示 (ビデオ調整中も有効) |
| `Esc` | 設定メニューを閉じる (ビデオ調整モードは維持) / 選択解除 |
| `Ctrl + Z / Y` | ライフのUndo / Redo |

## 🛠 技術スタック

-   **Framework**: React 19 (Vite 7)
-   **Language**: TypeScript
-   **Styling**: Vanilla CSS / Tailwind CSS
-   **Icons**: Lucide React
-   **State**: Zustand / IndexedDB (idb-keyval)
-   **Sync**: BroadcastChannel API

## 📝 免責事項

本アプリはファンメイドの非公式ツールです。カード画像の著作権等は各カードゲームの権利者に帰属します。アセットは各自の責任で用意して使用してください。

## 📝 ライセンス

MIT License
